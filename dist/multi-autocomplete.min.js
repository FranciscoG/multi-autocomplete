function MultiComplete(t){"use strict";if(!(this instanceof MultiComplete))return new MultiComplete(t);if(this.input=t.input,this.$input=$(t.input),!t.input||!this.$input.length)return void this.warn("input not set or doesn't exist");if(this.output=t.output,this.$output=$(t.output),!t.output||!this.$output.length)return void this.warn("preview container not set or doesn't exist");if(!t.datasets)return void this.warn("datasets missing");this.datasets=t.datasets;var e="";for(var i in this.datasets)e+=i;this.markersRegex=new RegExp("["+e+"]","i"),this.outputDom=t.outputDom||"li",this.activeClass=t.activeClass||"active",this.keycodes={up:38,down:40,left:37,right:39,enter:13,esc:27,tab:9,shift:16,del:8,space:32},this.info={},this._isPreviewing=!1,$("body").on("keyup",this.input,$.proxy(this.onKeyUp,this))}MultiComplete.prototype={warn:function(t){console&&console.warn&&console.warn("mutli-autocomplete:",t)},goForward:function(t,e){for(var i=strLen=t.length,s=e;s<strLen;s++)if(" "===t[s]){i=s;break}return i},goBackward:function(t,e){for(var i=0,s=e-1;s>=0;s--)if(" "===t[s]){i=s+1;break}return i},onKeyUp:function(t){var e=this.$input.val();if(e){var i,s,n=this.$input.get(0).selectionStart,r=e[n-1];s=" "===e[n]?n:this.goForward(e,n),i=" "===r?n:this.goBackward(e,n);var o=e.substring(i,s);this.info={start:i,end:s,fullStr:o,filterStr:o.substr(1),val:e};var a=o.charAt(0);return void(this.markersRegex.test(a)?(this.info.activeMarker=a,this.beginFiltering(a,o.substr(1)),this.navPreview(t.keyCode)):this.clearPreview())}e&&this.info.activeMarker||this.clearPreview()},clearPreview:function(){this.$output.empty(),this._isPreviewing=!1},beginFiltering:function(t,e){if(this.datasets[t]&&!this._isPreviewing){var i=this.datasets[t],s=$.grep(i,function(t){return t.indexOf(e)>=0});this.addToPreview(s)}},addToPreview:function(t){this.clearPreview();var e=this.outputDom,i=document.createDocumentFragment();$.each(t,function(t,s){var n=document.createElement(e);n.textContent=s,0===t&&n.classList.add("active"),i.appendChild(n)}),this.$output.append(i)},navPreview:function(t){var e;if(t===this.keycodes.up)e=-1,this._isPreviewing=!0;else{if(t!==this.keycodes.down)return void(this._isPreviewing=!1);e=1,this._isPreviewing=!0}var i=this.$output.children(),s=this.$output.find("."+this.activeClass).index(),n=s+e,r=i.length;0>n?n=r-1:n>r-1&&(n=0),i.removeClass("active").eq(n).addClass(this.activeClass);var o=this.$output.find("."+this.activeClass).text();this.replaceInPlace(o)},replaceInPlace:function(t){var e=this.info.val,i=e.slice(0,this.info.start)+this.info.activeMarker+t+e.slice(this.info.end,e.length-1);this.$input.val(i),console.log(i)},onSelectItem:function(t){if(t.keyCode===this.keycodes.enter){var e=$(this).find(".active").text();this.replaceInPlace(e)}}},"object"==typeof exports&&(module.exports=MultiComplete);