function MultiComplete(t){"use strict";if(!(this instanceof MultiComplete))return new MultiComplete(t);var e={outputDom:"li",activeClass:"active",fuzzyFilter:!0,beforeReplace:null,getActiveText:null,outputTemplate:null};if(this.opts=$.extend(e,t),this.$input=$(this.opts.input),!this.opts.input||!this.$input.length)return void this.warn("input not set or doesn't exist");if(this.$output=$(this.opts.output),!this.opts.output||!this.$output.length)return void this.warn("preview container not set or doesn't exist");if(!this.opts.datasets)return void this.warn("datasets missing");var i="";for(var s in this.opts.datasets)i+=s;this.markersRegex=new RegExp("["+i+"]","i"),this.inputNode=this.$input.get(0),this.outputNode=this.$output.get(0),this.keycodes={up:38,down:40,left:37,right:39,enter:13,esc:27,tab:9,shift:16,backspace:8,del:46,space:32},this.info={},this._isPreviewing=!1,$("body").on("keyup",this.opts.input,$.proxy(this.onKeyUp,this)),this.ignoreKey=!1,$("body").on("keydown keypress",this.opts.input,$.proxy(this.onKeyDown,this))}MultiComplete.prototype={warn:function(t){console&&console.warn&&console.warn("mutli-autocomplete:",t)},getNextSpace:function(t,e){var i=t.substring(e,t.length).indexOf(" ");return 0>i?t.length:i},getPrevSpace:function(t,e){var i=t.substring(0,e).lastIndexOf(" ");return 0>i?0:i+1},onKeyDown:function(t){var e,i=this;this.inputNode;return this.ignoreKey?(t.preventDefault(),!1):((t.keyCode===this.keycodes.up||t.keyCode===this.keycodes.down)&&(e=this.info.end,this.setCursorPosition(e),this.ignoreKey=!0,setTimeout(function(){i.ignoreKey=!1},1),t.preventDefault()),void(t.keyCode===this.keycodes.right&&this._isPreviewing&&(e=this.info.end,e>=this.info.val.length-1&&this.$input.val(this.$input.val()+" "),this.setCursorPosition(e+1),this.ignoreKey=!0,setTimeout(function(){i.ignoreKey=!1},1),t.preventDefault())))},onKeyUp:function(t){var e=this.inputNode.value;if(e){var i,s,n=this.inputNode.selectionStart,o=e[n-1];s=" "===e[n]?n:this.getNextSpace(e,n),i=" "===o?n:this.getPrevSpace(e,n);var r=e.substring(i,s);this.info={start:i,end:s,fullStr:r,filterStr:r.substr(1),val:e};var u=r.charAt(0);return void(this.markersRegex.test(u)?(this.info.activeMarker=u,this.beginFiltering(u,r.substr(1)),this.navPreview(t.keyCode)):this.clearPreview())}e&&this.info.activeMarker||this.clearPreview()},clearPreview:function(){this.$output.empty(),this._isPreviewing=!1},beginFiltering:function(t,e){if(this.opts.datasets[t]&&!this._isPreviewing){var i=this,s=this.opts.datasets[t],n=$.grep(s,function(t){return i.opts.fuzzyFilter?t.indexOf(e)>=0:0===t.indexOf(e)});this.addToPreview(n)}},addToPreview:function(t){this.clearPreview();var e=this,i=document.createDocumentFragment();$.each(t,function(t,s){var n=document.createElement(e.opts.outputDom);"function"==typeof e.opts.outputTemplate?n.innerHTML=e.opts.outputTemplate(e.info.activeMarker,s):n.textContent=s,0===t&&n.classList.add(e.opts.activeClass),i.appendChild(n)}),this.$output.append(i)},navPreview:function(t){var e;if(t===this.keycodes.up)e=-1,this._isPreviewing=!0,this.$output.focus();else{if(t!==this.keycodes.down)return this._isPreviewing=!1,void this.$input.focus();e=1,this._isPreviewing=!0,this.$output.focus()}var i=this.$output.children(),s=this.$output.find("."+this.opts.activeClass).index(),n=s+e,o=i.length;0>n?n=o-1:n>o-1&&(n=0),i.removeClass(this.opts.activeClass).eq(n).addClass(this.opts.activeClass);var r=this.$output.find("."+this.opts.activeClass);this.scrollOutput(r);var u;u="function"==typeof this.opts.getActiveText?this.opts.getActiveText(r):r.text(),this.replaceInPlace(u)},scrollOutput:function(t){t.length&&t.get(0).scrollIntoView(!1)},replaceInPlace:function(t){var e=this.info.val;"function"==typeof this.opts.beforeReplace&&(t=this.opts.beforeReplace(t,this.info.activeMarker));var i=e.slice(0,this.info.start)+t+e.slice(this.info.end,e.length-1);this.info.end=this.info.start+t.length+1,this.$input.val(i),this.setCursorPosition(this.info.end)},setCursorPosition:function(t){var e,i=this.inputNode;i.createTextRange?(e=i.createTextRange(),e.move("character",t),e.select()):(i.focus(),void 0!==i.selectionStart&&i.setSelectionRange(t,t))}},"object"==typeof exports&&(module.exports=MultiComplete);