var events=function(){var t={},e=t.hasOwnProperty;return{subscribe:function(i,s){e.call(t,i)||(t[i]=[]);var n=t[i].push(s)-1;return{remove:function(){delete t[i][n]}}},publish:function(i,s){e.call(t,i)&&t[i].forEach(function(t){t(void 0!=s?s:{})})}}}();(function(){"use strict";function t(e){if(!(this instanceof t))return new t(e);var i={output:null,input:null,outputDom:"li",activeClass:"active"};this.opts=Object.assign({},i,e),this.keys={up:38,down:40,left:37,right:39,enter:13,esc:27,tab:9,shiftKey:16,backspace:8,del:46,space:32,ctrl:17},this.states={isPreviewing:!1,inputHasFocus:!1,hasCancelled:!1},this.modKeys={ctrlDown:!1,shiftDown:!1},this.init()}t.prototype={init:function(){this.inputNode=document.querySelector(this.opts.input),this.outputNode=document.querySelector(this.opts.output);var t=this.checkRequirements();t&&(this.outputNode.tabIndex=0,this.inputNode.addEventListener("keydown",this.onInputKeydown.bind(this)),document.addEventListener("keyup",this.modifierKeysUp.bind(this)),document.addEventListener("keydown",this.modifierKeysDown.bind(this)),this.outputNode.addEventListener("click",this.onClickPick.bind(this)),this.outputNode.addEventListener("keydown",this.outputKeyup.bind(this)))},checkRequirements:function(){var t=!0;return this.opts.input&&this.inputNode||(this.warn("input option not provided or element is missing"),t=!1),this.opts.output&&this.outputNode||(this.warn("preview container not provided or element is missing"),t=!1),t},warn:function(t){throw new Error(t)},modifierKeysDown:function(t){t.keyCode===this.keys.ctrl&&(this.modKeys.ctrlDown=!0),t.keyCode===this.keys.shiftKey&&(this.modKeys.shiftKey=!0)},modifierKeysUp:function(t){t.keyCode===this.keys.ctrl&&(this.modKeys.ctrlDown=!1),t.keyCode===this.keys.shiftKey&&(this.modKeys.shiftKey=!1)},outputKeyup:function(t){return this.states.inputHasFocus=!1,this.handleKeys(t)},onInputKeydown:function(t){return this.states.inputHasFocus=!0,this.handleKeys(t)},handleKeys:function(t){switch(t.keyCode){case this.keys.up:if(this.states.isPreviewing)return t.preventDefault(),this.navPreview(-1),!1;break;case this.keys.tab:case this.keys.down:if(1===this.info.filteredData.length)return this.useActiveText(),this.clearPreview(!0),t.preventDefault(),!1;if(this.states.isPreviewing)return t.preventDefault(),this.navPreview(1),!1;break;case this.keys.right:if(this.modKeys.ctrlDown||this.modKeys.shiftDown||t.shiftKey||t.ctrlKey)return!0;if(this.states.isPreviewing)return this.useActiveText(),this.clearPreview(!0),t.preventDefault(),!1;break;case this.keys.enter:this.states.isPreviewing&&(this.useActiveText(),t.preventDefault(),t.stopImmediatePropagation()),this.clearPreview();break;case this.keys.esc:if(this.states.isPreviewing)return this.clearPreview(!0),this.states.isPreviewing=!1,this.states.hasCancelled=!0,!1;break;case this.keys.space:this.states.hasCancelled=!1,this.states.isPreviewing=!1,this.clearPreview();break;default:return this.states.isPreviewing=!1,!0}return!0},clearPreview:function(t){this.outputNode.innerHTML="",this.states.isPreviewing=!1,t&&(this.outputNode.style.display="none")},addToPreview:function(t,e){if(this.info=e,this.states.hasCancelled||0===t.length)return this.clearPreview(!0),!1;this.clearPreview(),this.states.isPreviewing=!0;var i,s=this,n=document.createDocumentFragment();"function"==typeof this.insertFirstCB&&(i=this.insertFirstCB(),i.nodeType?n.appendChild(i):this.warn("When using insertFirst you must return a valid node element other wise appendChild will break")),t.forEach(function(t,e,i){var r=document.createElement(s.opts.outputDom);"function"==typeof s.outputTemplateCB?r.innerHTML=s.outputTemplateCB(s.info.activeMarker,t):r.textContent=t,0===e&&r.classList.add(s.opts.activeClass),r.tabIndex=0,n.appendChild(r)}),this.outputNode.appendChild(n),this.outputNode.style.display="block",this.collection=this.outputNode.children},getIndex:function(t){for(var e=t.parentNode.childNodes,i=0,s=0;s<e.length;s++){if(e[s]===t)return i;1===e[s].nodeType&&i++}return-1},navPreview:function(t){var e=this.getIndex(this.outputNode.querySelector("."+this.opts.activeClass)),i=e+t,s=this.collection.length;0>i?i=s-1:i>s-1&&(i=0);var n=this,r=[].slice.call(this.collection);r.forEach(function(t,e,s){t.classList.remove(n.opts.activeClass),e===i&&t.classList.add(n.opts.activeClass)}),this.useActiveText()},getHighlighted:function(t){var e=this.outputNode.querySelector("."+this.opts.activeClass);t&&this.scrollOutput(e);var i;return i="function"==typeof this.getActiveTextCB?this.getActiveTextCB(e):e.textContent},useActiveText:function(){var t=this.getHighlighted(!0);this.replaceInPlace(t)},onClickPick:function(t){var e=t.target;if(e.tagName.toLowerCase()===this.opts.outputDom.toLowerCase()){var i;i="function"==typeof this.getActiveTextCB?this.getActiveTextCB(t.target):t.target.textContent,this.replaceInPlace(i),this.clearPreview(!0)}},scrollOutput:function(t){t&&t.scrollIntoView(!1)},replaceInPlace:function(t){var e=this.info.val;"function"==typeof this.beforeReplaceCB&&(t=this.beforeReplaceCB(this.info.activeMarker,t));var i=e.slice(0,this.info.start)+t+e.slice(this.info.end,e.length-1);this.info.end=this.info.start+t.length+1,this.inputNode.value=i+" ",this.setCursorPosition(this.info.end)},setCursorPosition:function(t){var e,i=this.inputNode;i.createTextRange?(e=i.createTextRange(),e.move("character",t),e.select()):(i.focus(),void 0!==i.selectionStart&&i.setSelectionRange(t,t)),this.states.inputHasFocus=!0},beforeReplace:function(t){this.beforeReplaceCB=t||null},getActiveText:function(t){this.getActiveTextCB=t||null},outputTemplate:function(t){this.outputTemplateCB=t||null},insertFirst:function(t){this.insertFirstCB=t||null}},function(t,e){return"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.PreviewHandler=e()}(this,function(){return t})}).call(this),function(){"use strict";function t(e){return this instanceof t?(this.defaults={fuzzyFilter:!1},this.opts=Object.assign({},this.defaults,e),void this.init()):new t(e)}t.prototype={init:function(){this.inputNode=document.querySelector(this.opts.input);var t=this.checkRequirements();t&&(this.markersRegex=this.getMarkers(),this.inputNode.addEventListener("keyup",this.onInputKeyup.bind(this)))},checkRequirements:function(){var t=!0;return this.opts.input&&this.inputNode||(this.warn("input option not provided or element is missing"),t=!1),this.opts.datasets||(this.warn("no datasets provided or error loading them"),t=!1),t},getMarkers:function(){var t="";for(var e in this.opts.datasets)({}).hasOwnProperty.call(this.opts.datasets,e)&&(t+=e);return this.makeRegex(t)},makeRegex:function(t){var e=t.replace(/([()[{*+.$^\\|?])/g,"\\$1");return new RegExp("["+e+"]","i")},warn:function(t){throw new Error(t)},getNextSpace:function(t,e){var i=t.substring(e,t.length).indexOf(" ");return 0>i?t.length:i+e},getPrevSpace:function(t,e){var i=t.substring(0,e).lastIndexOf(" ");return 0>i?0:i+1},findPositions:function(t,e){var i,s;s=" "===t[e]?e:this.getNextSpace(t,e);var n=t[e-1];return i=" "===n?e:this.getPrevSpace(t,e),[i,s]},testChar:function(t,e){return this.markersRegex.test(t)?(this.info.activeMarker=t,this.beginFiltering(t,e)):[]},onInputKeyup:function(t){var e=this.inputNode.value;return e?void this.handleValue(e):void 0},handleValue:function(t){var e=this.inputNode.selectionStart,i=this.findPositions(t,e),s=t.substring(i[0],i[1]);this.info={start:i[0],end:i[1],cursorPos:e,fullStr:s,filterStr:s.substr(1),val:t};var n=s.charAt(0),r=this.testChar(n,this.info.filterStr);this.publish(r)},beginFiltering:function(t,e){if(!this.opts.datasets[t])return[];var i=this.opts.datasets[t],s=this.getFilteredData(e,this.opts.fuzzyFilter,i);return this.info.filteredData=s,s},getFilteredData:function(t,e,i){return i.filter(function(i){return e===!0?i.indexOf(t)>=0:0===i.indexOf(t)})},publish:function(t){"function"==typeof this.subscribeCB&&this.subscribeCB(t,this.info)},onData:function(t){this.subscribeCB=t||function(){}}},function(t,e){return"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.MultiComplete=e()}(this,function(){return t})}.call(this);