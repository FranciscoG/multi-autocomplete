<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="test.css" />
  </head>

  <body>
    <div class="container cf">
      <h1>Multi-Autocomplete Testing Playground</h1>

      <div class="chat-area">
        
        <ul id="chatOutput">
          <li>hello</li>
        </ul>
        <ul id="preview-container"></ul>
        <input type="text" id="chatInput" placeholder="enter a chat message" autocomplete="off" maxlength="255" />
        <p>Press enter to submit chat</p>
      </div>

      <div class="example-data cf">
        <ul id="emojis">
          <li class="data-title">:emojis:</li>
        </ul>
        <ul id="mentions">
          <li class="data-title">@mentions</li>
        </ul>
      </div>

    </div>

    <script src="jquery-2.2.0.min.js"></script>
    <script src="../dist/multicomplete.js"></script>
    <script src="testdata.js"></script>
    <script>
      'use strict';
      
      /* playground setup */
      var chatOutput = document.getElementById('chatOutput');
      var createChatMessage = function(str){
        var li = document.createElement('li');
        li.textContent = str;
        chatOutput.appendChild(li);
      };

      $('#chatInput').on('keyup', function (e) {
        e.preventDefault();
        // console.log(e.keyCode);
        if (e.keyCode === 13) {
          createChatMessage($(this).val());
          $(this).val("");
        }
      });

      function makeLlist(arr, target) {
        var tmp = document.createDocumentFragment();
        arr.forEach(function(el,i,r){
          var li = document.createElement("li");
          li.textContent = el;
          tmp.appendChild(li);
        });
        document.getElementById(target).appendChild(tmp);
      }
      /* global datasets, MultiComplete */
      for (var key in datasets) {
        if (key === "@") {
           makeLlist(datasets["@"], "mentions");
        }

        if (key === ":") {
          makeLlist(datasets[":"], "emojis");
        }
      }

      /***********************************************
       * Here is where we instantiate the library
       */

      var mc = new MultiComplete({
        input: "#chatInput",
        output: "#preview-container",
        datasets : datasets,
        fuzzyFilter : false,
        beforeReplace: function(marker, str) {
          if (marker === ":") {
            return ":" + str + ":";
          }
          if (marker === "@") {
            return "@" + str;
          }
        },
        getActiveText: function($elem) {
          return $elem.find("span").text();
        },
        outputTemplate : function(marker, str) {
          if (marker === ":") {
            return 'emoji: <span>'+str+'</span>';
          }
          if (marker === "@") {
            return 'mention: <span>'+str+'</span>';
          }
        }
      });

    </script>
    
  </body>
</html>