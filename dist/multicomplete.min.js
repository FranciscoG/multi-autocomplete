(function(){"use strict";function t(e){if(!(this instanceof t))return new t(e);var i={output:null,input:null,outputDom:"li",activeClass:"active",beforeReplace:null,getActiveText:null,outputTemplate:null};this.opts=$.extend(!0,{},i,e),this.keys={up:38,down:40,left:37,right:39,enter:13,esc:27,tab:9,shiftKey:16,backspace:8,del:46,space:32,ctrl:17},this.states={isPreviewing:!1,inputHasFocus:!1,hasCancelled:!1},this.modKeys={ctrlDown:!1,shiftDown:!1}}t.prototype={init:function(){return this.$input=$(this.opts.input),this.opts.input&&this.$input.length?(this.$output=$(this.opts.output),this.opts.output&&this.$output.length?(this.inputNode=this.$input.get(0),this.outputNode=this.$output.get(0),this.outputNode.tabIndex=0,this.$input.on("keydown",$.proxy(this.onInputKeydown,this)),$(document).on("keyup",$.proxy(this.modifierKeysUp,this)),$(document).on("keydown",$.proxy(this.modifierKeysDown,this)),this.$output.on("click",this.opts.outputDom,$.proxy(this.onClickPick,this)),void this.$output.on("keyup",$.proxy(this.outputKeyup,this))):void this.warn("preview container not provided or element is missing")):void this.warn("input option not provided or element is missing")},warn:function(t){throw new Error(t)},modifierKeysDown:function(t){t.keyCode===this.keys.ctrl&&(this.modKeys.ctrlDown=!0),t.keyCode===this.keys.shiftKey&&(this.modKeys.shiftKey=!0)},modifierKeysUp:function(t){t.keyCode===this.keys.ctrl&&(this.modKeys.ctrlDown=!1),t.keyCode===this.keys.shiftKey&&(this.modKeys.shiftKey=!1)},outputKeyup:function(t){return this.states.inputHasFocus=!1,this.handleKeys(t)},onInputKeydown:function(t){return this.states.inputHasFocus=!0,this.handleKeys(t)},handleKeys:function(t){switch(t.keyCode){case this.keys.up:if(this.states.isPreviewing)return t.preventDefault(),this.navPreview(-1),!1;break;case this.keys.tab:case this.keys.down:if(1===this.info.filteredDataLength)return this.useActiveText(),this.clearPreview(),t.preventDefault(),!1;if(this.states.isPreviewing)return t.preventDefault(),this.navPreview(1),!1;break;case this.keys.right:if(this.modKeys.ctrlDown||this.modKeys.shiftDown||t.shiftKey||t.ctrlKey)return!0;if(this.states.isPreviewing)return this.useActiveText(),this.clearPreview(),t.preventDefault(),!1;break;case this.keys.enter:this.states.isPreviewing&&(this.useActiveText(),t.preventDefault(),t.stopImmediatePropagation()),this.clearPreview();break;case this.keys.esc:if(this.states.isPreviewing)return this.clearPreview(),this.states.isPreviewing=!1,this.states.hasCancelled=!0,!1;break;case this.keys.space:this.states.hasCancelled=!1,this.states.isPreviewing=!1,this.clearPreview();break;default:return this.states.isPreviewing=!1,!0}return!0},clearPreview:function(){this.$output.empty(),this.$output.hide(),this.states.isPreviewing=!1},addToPreview:function(t){if(this.states.hasCancelled)return!1;this.clearPreview(),this.states.isPreviewing=!0;var e=this,i=document.createDocumentFragment();$.each(t,function(t,s){var n=document.createElement(e.opts.outputDom);"function"==typeof e.opts.outputTemplate?n.innerHTML=e.opts.outputTemplate(e.info.activeMarker,s):n.textContent=s,0===t&&n.classList.add(e.opts.activeClass),n.tabIndex=0,i.appendChild(n)}),this.$output.append(i).slideDown(200),this.$collection=this.$output.children()},navPreview:function(t){var e=this.$output.find("."+this.opts.activeClass).index(),i=e+t,s=this.$collection.length;0>i?i=s-1:i>s-1&&(i=0),this.$collection.removeClass(this.opts.activeClass).eq(i).addClass(this.opts.activeClass),this.useActiveText()},getActiveText:function(t){var e=this.$output.find("."+this.opts.activeClass);t&&this.scrollOutput(e);var i;return i="function"==typeof this.opts.getActiveText?this.opts.getActiveText(e):e.text()},useActiveText:function(){var t=this.getActiveText(!0);this.replaceInPlace(t)},onClickPick:function(t){var e;e="function"==typeof this.opts.getActiveText?this.opts.getActiveText($(t.target)):$(t.target).text(),this.replaceInPlace(e),this.clearPreview()},scrollOutput:function(t){t.length&&t.get(0).scrollIntoView(!1)},replaceInPlace:function(t){var e=this.info.val;"function"==typeof this.opts.beforeReplace&&(t=this.opts.beforeReplace(this.info.activeMarker,t));var i=e.slice(0,this.info.start)+t+e.slice(this.info.end,e.length-1);this.info.end=this.info.start+t.length+1,this.$input.val(i+" "),this.setCursorPosition(this.info.end)},setCursorPosition:function(t){var e,i=this.inputNode;i.createTextRange?(e=i.createTextRange(),e.move("character",t),e.select()):(i.focus(),void 0!==i.selectionStart&&i.setSelectionRange(t,t)),this.states.inputHasFocus=!0}},function(t,e){return"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.PreviewHandler=e()}(this,function(){return t})}).call(this),function(){"use strict";function t(e){return this instanceof t?(this.defaults={fuzzyFilter:!0},this.opts=$.extend(!0,{},this.defaults,e),void this.init()):new t(e)}t.prototype={init:function(){if(this.$input=$(this.opts.input),!this.opts.input||!this.$input.length)return void this.warn("input option not provided or element is missing");if(!this.opts.datasets)return void this.warn("no datasets provided or error loading them");var t="";for(var e in this.opts.datasets)t+=e;this.markersRegex=this.makeRegex(t),this.inputNode=this.$input.get(0),this.info={filteredDataLength:0},this.$input.on("keyup",$.proxy(this.onInputKeyup,this)),this.previewhandler=new PreviewHandler(this.opts),this.previewhandler.init()},makeRegex:function(t){var e=t.replace(/([()[{*+.$^\\|?])/g,"\\$1");return new RegExp("["+e+"]","i")},warn:function(t){throw new Error(t)},getNextSpace:function(t,e){var i=t.substring(e,t.length).indexOf(" ");return 0>i?t.length:i+e},getPrevSpace:function(t,e){var i=t.substring(0,e).lastIndexOf(" ");return 0>i?0:i+1},findPositions:function(t,e){var i,s;s=" "===t[e]?e:this.getNextSpace(t,e);var n=t[e-1];return i=" "===n?e:this.getPrevSpace(t,e),[i,s]},testCharAndFilter:function(t,e){return this.markersRegex.test(t)?(this.info.activeMarker=t,this.beginFiltering(t,e)):[]},onInputKeyup:function(t){var e=this.inputNode.value;if(e){var i=this.inputNode.selectionStart,s=this.findPositions(e,i),n=e.substring(s[0],s[1]);this.info={start:s[0],end:s[1],cursorPos:i,fullStr:n,filterStr:n.substr(1),val:e};var o=n.charAt(0),r=this.testCharAndFilter(o,this.info.filterStr);return void(r.length>0?this.sendToPreview(r):this.noData())}e&&this.info.activeMarker&&""!==e||this.noData()},beginFiltering:function(t,e){if(!this.opts.datasets[t])return[];var i=this.opts.datasets[t],s=this.getFilteredData(e,this.opts.fuzzyFilter,i);return this.info.filteredDataLength=s.length,this.info.filteredData=s,s},getFilteredData:function(t,e,i){return $.grep(i,function(i){return e===!0?i.indexOf(t)>=0:0===i.indexOf(t)})},sendToPreview:function(t){this.previewhandler.info=this.info,this.previewhandler.addToPreview(t)},noData:function(){}},function(t,e){return"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.MultiComplete=e()}(this,function(){return t})}.call(this);