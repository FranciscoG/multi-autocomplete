function MultiComplete(t){"use strict";if(!(this instanceof MultiComplete))return new MultiComplete(t);if(this.input=t.input,this.$input=$(t.input),!t.input||!this.$input.length)return void this.warn("input not set or doesn't exist");if(this.output=t.output,this.$output=$(t.output),!t.output||!this.$output.length)return void this.warn("preview container not set or doesn't exist");if(!t.datasets)return void this.warn("datasets missing");this.datasets=t.datasets;var e="";for(var i in this.datasets)e+=i;this.markersRegex=new RegExp("["+e+"]","i"),this.outputDom=t.outputDom||"li",this.activeClass=t.activeClass||"active",this.callback=t.callback,this.beforeReplace=t.beforeReplace,this.keycodes={up:38,down:40,left:37,right:39,enter:13,esc:27,tab:9,shift:16,del:8,winDel:46,space:32},this.info={},this._isPreviewing=!1,$("body").on("keyup",this.input,$.proxy(this.onKeyUp,this)),$("body").on("keydown",this.input,$.proxy(this.onKeyDown,this))}MultiComplete.prototype={warn:function(t){console&&console.warn&&console.warn("mutli-autocomplete:",t)},goForward:function(t,e){var i=t.substring(e,t.length).indexOf(" ");return 0>i?t.length:i},goBackward:function(t,e){var i=t.substring(0,e).lastIndexOf(" ");return 0>i?0:i+1},onKeyDown:function(t){var e=t.keyCode===this.keycodes.up||t.keyCode===this.keycodes.down;return this._isPreviewing&&e?(console.log("prevent"),t.preventDefault(),!1):void 0},onKeyUp:function(t){var e=this.$input.val();if(e){var i,s,n=this.$input.get(0).selectionStart,o=e[n-1];s=" "===e[n]?n:this.goForward(e,n),i=" "===o?n:this.goBackward(e,n);var r=e.substring(i,s);this.info={start:i,end:s,fullStr:r,filterStr:r.substr(1),val:e};var a=r.charAt(0);return void(this.markersRegex.test(a)?(this.info.activeMarker=a,this.beginFiltering(a,r.substr(1)),this.navPreview(t.keyCode)):this.clearPreview())}e&&this.info.activeMarker||this.clearPreview()},clearPreview:function(){this.$output.empty(),this._isPreviewing=!1},beginFiltering:function(t,e){if(this.datasets[t]&&!this._isPreviewing){var i=this.datasets[t],s=$.grep(i,function(t){return t.indexOf(e)>=0});"function"==typeof this.callback&&(s=this.callback(s)),this.addToPreview(s)}},addToPreview:function(t){this.clearPreview();var e=this.outputDom,i=document.createDocumentFragment();$.each(t,function(t,s){var n=document.createElement(e);n.textContent=s,0===t&&n.classList.add("active"),i.appendChild(n)}),this.$output.append(i)},navPreview:function(t){var e;if(t===this.keycodes.up)e=-1,this._isPreviewing=!0,this.$output.get(0).focus();else{if(t!==this.keycodes.down)return this._isPreviewing=!1,void this.$input.get(0).focus();e=1,this._isPreviewing=!0,this.$output.get(0).focus()}var i=this.$output.children(),s=this.$output.find("."+this.activeClass).index(),n=s+e,o=i.length;0>n?n=o-1:n>o-1&&(n=0),i.removeClass("active").eq(n).addClass(this.activeClass);var r=this.$output.find("."+this.activeClass).text();this.replaceInPlace(r)},replaceInPlace:function(t){var e=this.info.val;"function"==typeof this.beforeReplace&&(t=this.beforeReplace(t));var i=e.slice(0,this.info.start)+this.info.activeMarker+t+e.slice(this.info.end,e.length-1);this.info.end=this.info.start+t.length+1,this.$input.val(i),this.setCursorPosition(this.info.end),console.log(this.info.end,i)},setCursorPosition:function(t){var e,i=this.$input.get(0);i.createTextRange?(e=i.createTextRange(),e.move("character",t),e.select()):(i.focus(),void 0!==i.selectionStart&&i.setSelectionRange(t,t))}},"object"==typeof exports&&(module.exports=MultiComplete);